<div class="user-encyclopedia" fxLayout="row wrap" fxLayoutGap="10px grid" [@fadeInOnEnter]>

  <div fxFlex.xl="100" fxFlex.lg="100" fxFlex.md="100" fxFlex.sm="100" fxFlex.xs="100" class="table-responsive">

    <mat-card>
      <mat-card-header>
        <img mat-card-avatar src="/assets/images/cards/encyclopedia.png">
        <mat-card-title>{{ 'user.encyclopedia.name' | translate }}</mat-card-title>
        <mat-card-subtitle>{{ 'user.encyclopedia.description' | translate }}</mat-card-subtitle>
        <div class="mat-card-extras">
          <button mat-icon-button (click)="this.tutorialService.start('tour.encyclopedia')"><mat-icon>help</mat-icon></button>
          <mat-chip-list><mat-chip color="primary"><mat-icon>description</mat-icon>{{ data.data.length | long }}</mat-chip></mat-chip-list>
        </div>
      </mat-card-header>

      <mat-card-content>
        <p>{{ 'user.encyclopedia.help' | translate }}</p>
        <table mat-table matSort matSortActive="name" matSortDirection="asc" [dataSource]="data" tourAnchor="tour.encyclopedia">
          <ng-container matColumnDef="{{ column }}" *ngFor="let column of columns">
            <mat-header-cell class="table-header" *matHeaderCellDef>
              <div mat-sort-header>{{ 'table.column.' + column | translate }}</div>

              <mat-form-field class="table-filter" *ngIf="filters[column] && filters[column].type === 'text'">
                <input matInput [(ngModel)]="filters[column].value" (keyup)="applyFilter()" autocomplete="off">
                <button mat-button *ngIf="filters[column].value" matSuffix mat-icon-button (click)="filters[column].value=''; applyFilter()">
                  <mat-icon>close</mat-icon>
                </button>
              </mat-form-field>

              <mat-form-field class="table-filter" *ngIf="filters[column] && filters[column].type === 'select'">
                <mat-select [(ngModel)]="filters[column].value" (selectionChange)="applyFilter()">
                  <!--<mat-option value="">{{ 'table.filter.any' | translate }}</mat-option>-->
                  <!--<mat-option *ngFor="let option of filters[column].options" [value]="option.value">{{ option.name | translate }}</mat-option>-->
                  <mat-option *ngFor="let option of filters[column].options" [value]="option">
                    <mat-list dense>
                      <mat-list-item [ngClass]="option.id">
                        <div mat-list-avatar>
                          <img mat-list-avatar [src]="option.image">
                        </div>
                        <div mat-line>{{ option.name | translate }}</div>
                      </mat-list-item>
                    </mat-list>
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field class="table-filter" *ngIf="filters[column] && filters[column].type === 'multiple'">
                <mat-select [(ngModel)]="filters[column].value" (selectionChange)="applyFilter()" multiple>
                  <mat-option *ngFor="let option of filters[column].options" [value]="option.value">
                    <mat-chip-list>
                      <mat-chip color="primary" selected [ngClass]="option.name.includes('legendary') ? 'legendary' : ''">
                        <img class="icon" [src]="option.name.includes('legendary') ? '/assets/images/icons/legendary.png' : '/assets/images/icons/type.png'">{{ option.name | translate }}
                      </mat-chip>
                    </mat-chip-list>
                  </mat-option>
                </mat-select>
              </mat-form-field>

            </mat-header-cell>

            <mat-cell *matCellDef="let row" [attr.data-label]="'table.column.' + column | translate">

              <ng-template [ngIf]="column === 'name'">
                <mat-list dense>
                  <mat-list-item [ngClass]="[row.faction.id, (row | legendary) ? 'legendary' : 'common']">
                    <div mat-list-avatar [matBadge]="row.level || '?'" matBadgePosition="above before">
                      <img mat-list-avatar [src]="row.image">
                    </div>
                    <div mat-line>{{ row.name | translate:{name:'?'} }}</div>
                    <div mat-line class="mat-card-subtitle" *ngIf="['god', 'family', 'skill', 'resource', 'category'].includes(row.type)">{{ row.description | translate }}</div>
                    <div mat-line class="mat-card-subtitle" *ngIf="['spell', 'structure', 'location', 'hero', 'item'].includes(row.type)" [innerHTML]="row.description | translate | icon:row"></div>
                    <div mat-line class="mat-card-subtitle" *ngIf="['unit'].includes(row.type)">
                      <img [title]="family.name | translate" class="icon" *ngFor="let family of row.families" [src]="family.image">
                      <img [title]="skill.name | translate" class="icon" *ngFor="let skill of row.skills" [src]="skill.image">
                      <img [title]="category.name | translate" class="icon" *ngFor="let category of row.categories" [src]="category.image">
                      <img [title]="'category.legendary.name' | translate" class="icon" *ngIf="row.legendary" src="/assets/images/icons/legendary.png">
                    </div>
                    <div mat-line class="mat-card-subtitle" *ngIf="['unit'].includes(row.type) && row.resistances && row.resistances.length">
                      <img [title]="('category.resistance.name' | translate) + (category.name | translate)" class="icon grayscale" *ngFor="let category of row.resistances" [src]="category.image">
                    </div>
                  </mat-list-item>
                </mat-list>
              </ng-template>

              <ng-template [ngIf]="column === 'faction'">
                <mat-list dense>
                  <mat-list-item [ngClass]="row.faction.id">
                    <div mat-list-avatar>
                      <img mat-list-avatar [src]="row.faction.image">
                    </div>
                    <div mat-line>{{ row.faction.name | translate }}</div>
                    <div mat-line class="mat-card-subtitle" [innerHTML]="row.faction.description | translate | icon:row.faction"></div>
                  </mat-list-item>
                </mat-list>
              </ng-template>

              <ng-template [ngIf]="column === 'type'">
                <mat-chip-list>
                  <mat-chip color="primary" selected><img class="icon" src="/assets/images/icons/type.png">{{ 'type.' + row.type + '.name'  | translate }}</mat-chip>
                  <mat-chip color="primary" selected *ngIf="row.subtype"><img class="icon" src="/assets/images/icons/type.png">{{ 'type.' + row.subtype + '.name'  | translate }}</mat-chip>
                  <mat-chip color="primary" selected *ngIf="row.legendary" class="legendary"><img class="icon" src="/assets/images/icons/legendary.png">{{ 'category.legendary.name' | translate }}</mat-chip>
                </mat-chip-list>
              </ng-template>

            </mat-cell>
          </ng-container>

          <mat-header-row *matHeaderRowDef="columns; sticky: true"></mat-header-row>
          <mat-row *matRowDef="let tome; columns: columns;" (click)="openTomeDialog(tome)"></mat-row>
        </table>

        <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>

      </mat-card-content>
    </mat-card>
  </div>

  <div fxFlex.xl="33" fxFlex.lg="33" fxFlex.md="50" fxFlex.sm="100" fxFlex.xs="100">
    <mat-card>
      <mat-card-header>
        <img mat-card-avatar src="/assets/images/cards/city.png">
        <mat-card-title>{{ 'kingdom.city.name' | translate }}</mat-card-title>
        <mat-card-subtitle>{{ 'kingdom.city.description' | translate }}</mat-card-subtitle>
      </mat-card-header>
      <img mat-card-image src="/assets/images/encyclopedia/city.png"/>
      <mat-card-content>
        <p [innerHTML]="'kingdom.city.tour' | translate | icon"></p>
      </mat-card-content>
    </mat-card>
  </div>

  <div fxFlex.xl="33" fxFlex.lg="33" fxFlex.md="50" fxFlex.sm="100" fxFlex.xs="100">
    <mat-card>
      <mat-card-header>
        <img mat-card-avatar src="/assets/images/cards/auction.png">
        <mat-card-title>{{ 'kingdom.auction.name' | translate }}</mat-card-title>
        <mat-card-subtitle>{{ 'kingdom.auction.description' | translate }}</mat-card-subtitle>
      </mat-card-header>
      <img mat-card-image src="/assets/images/encyclopedia/auction.png"/>
      <mat-card-content>
        <p [innerHTML]="'kingdom.auction.tour' | translate | icon"></p>
      </mat-card-content>
    </mat-card>
  </div>

  <div fxFlex.xl="33" fxFlex.lg="33" fxFlex.md="50" fxFlex.sm="100" fxFlex.xs="100">
    <mat-card>
      <mat-card-header>
        <img mat-card-avatar src="/assets/images/cards/emporium.png">
        <mat-card-title>{{ 'kingdom.emporium.name' | translate }}</mat-card-title>
        <mat-card-subtitle>{{ 'kingdom.emporium.description' | translate }}</mat-card-subtitle>
      </mat-card-header>
      <img mat-card-image src="/assets/images/encyclopedia/emporium.png"/>
      <mat-card-content>
        <p [innerHTML]="'kingdom.emporium.tour' | translate | icon"></p>
      </mat-card-content>
    </mat-card>
  </div>

  <div fxFlex.xl="33" fxFlex.lg="33" fxFlex.md="50" fxFlex.sm="100" fxFlex.xs="100">
    <mat-card>
      <mat-card-header>
        <img mat-card-avatar src="/assets/images/cards/map.png">
        <mat-card-title>{{ 'world.map.name' | translate }}</mat-card-title>
        <mat-card-subtitle>{{ 'world.map.description' | translate }}</mat-card-subtitle>
      </mat-card-header>
      <img mat-card-image src="/assets/images/encyclopedia/map.png"/>
      <mat-card-content>
        <p [innerHTML]="'world.map.tour' | translate | icon"></p>
      </mat-card-content>
    </mat-card>
  </div>

  <div fxFlex.xl="33" fxFlex.lg="33" fxFlex.md="50" fxFlex.sm="100" fxFlex.xs="100">
    <mat-card>
      <mat-card-header>
        <img mat-card-avatar src="/assets/images/cards/army.png">
        <mat-card-title>{{ 'kingdom.army.name' | translate }}</mat-card-title>
        <mat-card-subtitle>{{ 'kingdom.army.description' | translate }}</mat-card-subtitle>
      </mat-card-header>
      <img mat-card-image src="/assets/images/encyclopedia/army.png"/>
      <mat-card-content>
        <p [innerHTML]="'kingdom.army.tour' | translate | icon"></p>
      </mat-card-content>
    </mat-card>
  </div>

  <div fxFlex.xl="33" fxFlex.lg="33" fxFlex.md="50" fxFlex.sm="100" fxFlex.xs="100">
    <mat-card>
      <mat-card-header>
        <img mat-card-avatar src="/assets/images/cards/tavern.png">
        <mat-card-title>{{ 'kingdom.tavern.name' | translate }}</mat-card-title>
        <mat-card-subtitle>{{ 'kingdom.tavern.description' | translate }}</mat-card-subtitle>
      </mat-card-header>
      <img mat-card-image src="/assets/images/encyclopedia/tavern.png"/>
      <mat-card-content>
        <p [innerHTML]="'kingdom.tavern.tour' | translate | icon"></p>
      </mat-card-content>
    </mat-card>
  </div>

  <div fxFlex.xl="33" fxFlex.lg="33" fxFlex.md="50" fxFlex.sm="100" fxFlex.xs="100">
    <mat-card>
      <mat-card-header>
        <img mat-card-avatar src="/assets/images/cards/census.png">
        <mat-card-title>{{ 'kingdom.census.name' | translate }}</mat-card-title>
        <mat-card-subtitle>{{ 'kingdom.census.description' | translate }}</mat-card-subtitle>
      </mat-card-header>
      <img mat-card-image src="/assets/images/encyclopedia/census.png"/>
      <mat-card-content>
        <p [innerHTML]="'kingdom.census.tour' | translate | icon"></p>
      </mat-card-content>
    </mat-card>
  </div>

  <div fxFlex.xl="33" fxFlex.lg="33" fxFlex.md="50" fxFlex.sm="100" fxFlex.xs="100">
    <mat-card>
      <mat-card-header>
        <img mat-card-avatar src="/assets/images/cards/archive.png">
        <mat-card-title>{{ 'kingdom.archive.name' | translate }}</mat-card-title>
        <mat-card-subtitle>{{ 'kingdom.archive.description' | translate }}</mat-card-subtitle>
      </mat-card-header>
      <img mat-card-image src="/assets/images/encyclopedia/archive.png"/>
      <mat-card-content>
        <p [innerHTML]="'kingdom.archive.tour' | translate | icon"></p>
      </mat-card-content>
    </mat-card>
  </div>

  <div fxFlex.xl="33" fxFlex.lg="33" fxFlex.md="50" fxFlex.sm="100" fxFlex.xs="100">
    <mat-card>
      <mat-card-header>
        <img mat-card-avatar src="/assets/images/cards/clan.png">
        <mat-card-title>{{ 'kingdom.clan.name' | translate }}</mat-card-title>
        <mat-card-subtitle>{{ 'kingdom.clan.description' | translate }}</mat-card-subtitle>
      </mat-card-header>
      <img mat-card-image src="/assets/images/encyclopedia/clan.png"/>
      <mat-card-content>
        <p [innerHTML]="'kingdom.clan.tour' | translate | icon"></p>
      </mat-card-content>
    </mat-card>
  </div>

  <div fxFlex.xl="33" fxFlex.lg="33" fxFlex.md="50" fxFlex.sm="100" fxFlex.xs="100">
    <mat-card>
      <mat-card-header>
        <img mat-card-avatar src="/assets/images/cards/sorcery.png">
        <mat-card-title>{{ 'kingdom.sorcery.name' | translate }}</mat-card-title>
        <mat-card-subtitle>{{ 'kingdom.sorcery.description' | translate }}</mat-card-subtitle>
      </mat-card-header>
      <img mat-card-image src="/assets/images/encyclopedia/sorcery.png"/>
      <mat-card-content>
        <p [innerHTML]="'kingdom.sorcery.tour' | translate | icon"></p>
      </mat-card-content>
    </mat-card>
  </div>

  <div fxFlex.xl="33" fxFlex.lg="33" fxFlex.md="50" fxFlex.sm="100" fxFlex.xs="100">
    <mat-card>
      <mat-card-header>
        <img mat-card-avatar src="/assets/images/cards/temple.png">
        <mat-card-title>{{ 'kingdom.temple.name' | translate }}</mat-card-title>
        <mat-card-subtitle>{{ 'kingdom.temple.description' | translate }}</mat-card-subtitle>
      </mat-card-header>
      <img mat-card-image src="/assets/images/encyclopedia/temple.png"/>
      <mat-card-content>
        <p [innerHTML]="'kingdom.temple.tour' | translate | icon"></p>
      </mat-card-content>
    </mat-card>
  </div>

  <div fxFlex.xl="33" fxFlex.lg="33" fxFlex.md="50" fxFlex.sm="100" fxFlex.xs="100">
    <mat-card>
      <mat-card-header>
        <img mat-card-avatar src="/assets/images/cards/encyclopedia.png">
        <mat-card-title>{{ 'user.encyclopedia.name' | translate }}</mat-card-title>
        <mat-card-subtitle>{{ 'user.encyclopedia.description' | translate }}</mat-card-subtitle>
      </mat-card-header>
      <img mat-card-image src="/assets/images/encyclopedia/encyclopedia.png"/>
      <mat-card-content>
        <p [innerHTML]="'user.encyclopedia.tour' | translate | icon"></p>
      </mat-card-content>
    </mat-card>
  </div>

</div>
